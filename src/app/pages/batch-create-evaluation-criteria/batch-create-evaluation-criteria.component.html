<div class="container eC-container">
  <div class="heading">
    <h4> TYPE OF ASSESSMENT : CREATE AND EDIT </h4>
  </div>
  <div class="container d-flex justify-content-center align-items-center p-5">
    <div class="table-and-search d-flex flex-column align-items-center justify-content-end">
      <div class="input-group d-flex flex-row align-items-center justify-content-end">
        <input
          type="text"
          pInputText
          class="search mb-2"
          placeholder="Search"
          [formControl]="searchControl"
          aria-label="Search-text"
          aria-describedby="button-addon2"
        />
      </div>

        <p-table
          [value]="filteredColumns"
          [paginator]="true"
          [rows]="6"
          [showCurrentPageReport]="true"
          [tableStyle]="{}"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        >
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 10%">SL No.</th>
              <th style="width: 70%">Type of assessment</th>
              <th style="width: 10%"></th>
              <th style="width: 10%"></th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-eC let-rowIndex="rowIndex">
            <tr>
              <td>{{ rowIndex + 1 }}</td>
              <td>
                <ng-container *ngIf="!eC.editing; else editECName">
                  {{ eC.assessment_type_name }}
                </ng-container>
                <ng-template #editECName>
                  <input
                    type="text"
                    [(ngModel)]="eC.assessment_type_name"
                    (keydown.enter)="toggleEdit(eC)"
                    (blur)="toggleEdit(eC)"
                    class="form-control"
                  />
                </ng-template>
              </td>
              <td>
                <button class="btn btn-link" (click)="toggleEdit(eC)">
                  <i class="bi bi-pencil-square"></i>
                </button>
              </td>
              <td>
                <button class="btn btn-link" (click)="deleteEC(eC)">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
          </ng-template>
        </p-table>

      <button class="add-phase-button" data-bs-toggle="modal" data-bs-target="#addPhaseModal">
        <i class="bi bi-plus-lg"></i> Add an Assessment type
      </button>
    </div>

    <div class="modal fade" id="addPhaseModal" tabindex="-1" aria-labelledby="addPhaseModal" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Add an Assessment type</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form [formGroup]="CriteriaForm" (ngSubmit)="saveNewEC()">
              <div class="mb-3">
                <div class="d-flex flex-row justify-content-center row">
                  <div class="col-6">
                    <label class="col-6">Assessment type:</label>
                  </div>
                  <div class="col-6">
                    <input
                    type="text"
                    class="form-control new-phase-name col-6"
                    placeholder="Enter Assessment type here"
                    formControlName="eCName"
                  />
                  </div>

                </div>
                <div *ngIf="CriteriaForm.get('eCName')?.invalid && CriteriaForm.get('eCName')?.touched" class="text-danger">
                  <div *ngIf="CriteriaForm.get('eCName')?.errors?.['required']">
                    Evaluation Criteria is required.
                  </div>
                  <div *ngIf="CriteriaForm.get('eCName')?.errors?.['minlength']">
                    Evaluation Criteria must be at least 3 characters long.
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <app-hollow-button [hollowButtonLabel]="'Cancel'" [attr.data-bs-dismiss]="'modal'"></app-hollow-button>
            <app-button [buttonLabel]="'Save'" (click)="saveNewEC()"></app-button>
          </div>
        </div>
      </div>
    </div>

  </div>
  <div *ngIf="showMessage" class="alert alert-success" role="alert">
    Saved successfully!
  </div>
  <div class="buttons d-flex flex-row justify-content-center gap-4">
    <app-hollow-button [hollowButtonLabel]="'Go back'" (click)="goBack()"></app-hollow-button>
    <app-button [buttonLabel]="'Save'" (click)="logEC()"></app-button>
  </div>
</div>
